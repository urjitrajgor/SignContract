{"ast":null,"code":"'use strict';\n\nconst _require = require('readable-stream'),\n      Transform = _require.Transform,\n      PassThrough = _require.PassThrough;\n\nconst pump = require('pump');\n\nconst ndjson = require('ndjson');\n\nconst isStream = require('is-stream');\n\nconst toEntry = entry => {\n  return {\n    name: entry.Name,\n    type: entry.Type,\n    size: entry.Size,\n    hash: entry.Hash\n  };\n};\n\nmodule.exports = send => {\n  return (args, opts) => {\n    opts = opts || {};\n    const transform = new Transform({\n      objectMode: true,\n\n      transform(entry, encoding, callback) {\n        callback(null, toEntry(entry));\n      }\n\n    });\n    const output = new PassThrough({\n      objectMode: true\n    });\n    send({\n      path: 'files/ls',\n      args: args,\n      qs: Object.assign({}, opts, {\n        stream: true\n      })\n    }, (err, res) => {\n      if (err) {\n        return output.destroy(err);\n      }\n\n      if (isStream(res)) {\n        const parse = ndjson.parse();\n        pump(res, parse, transform, output);\n      } else {\n        const entries = res.Entries || [];\n        entries.forEach(entry => {\n          output.write(toEntry(entry));\n        });\n        output.end();\n      }\n    });\n    return output;\n  };\n};","map":null,"metadata":{},"sourceType":"script"}